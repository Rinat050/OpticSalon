@using OpticSalon.Blazor.Shared.Dialogs
@using OpticSalon.Domain.Enums
@using OpticSalon.Domain.Extensions
@using OpticSalon.Domain.Models

@inject NavigationManager NavManager
@inject IWarrantyRepairService RepairService

@if (_isLoading)
{
    <MudProgressLinear Color="MudBlazor.Color.Info" Indeterminate="true" Class="m-1" />
    return;
}

@if (Repaires.Count() == 0)
{
    <MudAlert Class="m-2" Severity="Severity.Normal">Ремонтов пока нет...</MudAlert>
    return;
}

<MudTable T="WarrantyRepairForClient" Items="@Repaires">
    <HeaderContent>
        <MudTh>Номер ремонта</MudTh>
        <MudTh>Дата оформления</MudTh>
        <MudTh>Номер заказа</MudTh>
        <MudTh>Статус</MudTh>
        <MudTh>Просмотр</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Номер заказа">@context.Id</MudTd>
        <MudTd DataLabel="Дата оформления">@context.CreatedDate</MudTd>
        <MudTd DataLabel="Номер заказа">@context.OrderId</MudTd>
        <MudTd DataLabel="Статус"><MudChip Color="@_statusColors[context.Status]">@context.Status.GetDisplayName()</MudChip></MudTd>
        <MudTd DataLabel="Просмотр"><MudIconButton Icon="@Icons.Material.Filled.ArrowRight" OnClick="@(() => OpenRepairInfo(context.Id))"></MudIconButton></MudTd>
    </RowTemplate>
</MudTable>


@code {
    [Parameter]
    public List<WarrantyRepairForClient> Repaires { get; set; } = new();
    private bool _isLoading;

    private Dictionary<OrderStatus, MudBlazor.Color> _statusColors = new Dictionary<OrderStatus, MudBlazor.Color>()
    {
        {OrderStatus.Created , MudBlazor.Color.Surface},
        {OrderStatus.InWork , MudBlazor.Color.Warning},
        {OrderStatus.Completed , MudBlazor.Color.Info},
        {OrderStatus.Issued , MudBlazor.Color.Success}
    };

    private async Task OpenRepairInfo(int repair)
    {
        NavManager.NavigateTo($"/warrantyRepair/{repair}");
    }
}
