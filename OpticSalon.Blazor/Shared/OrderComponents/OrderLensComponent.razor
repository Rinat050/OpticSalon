@using MudBlazor.Utilities
@using OpticSalon.Domain.FilterData
@using OpticSalon.Domain.Models


@if (_isLoading)
{
    <MudProgressLinear Color="MudBlazor.Color.Info" Indeterminate="true" Class="m-1" />
    return;
}

<MudContainer Class="d-flex align-center justify-center mud-width-full">
    <MudCard Class="p-4 m-2 w-100" Style="border-radius: 15px;"
             Outlined="false" Elevation="5">
        <MudList Clickable="true">
            <MudListSubheader>
                <MudStack Row AlignItems="AlignItems.Center">
                    <MudIcon Icon="@Icons.Material.Outlined.Lens" Size="Size.Large"
                             Color="MudBlazor.Color.Secondary"></MudIcon>
                    <MudText Typo="Typo.h5" Color="MudBlazor.Color.Secondary">
                        Выбор линз
                    </MudText>
                </MudStack>
            </MudListSubheader>
            @foreach (var lens in Packages)
            {
                <MudListItem OnClick="(() => SelectLens(lens))" Icon="@(GetListItemIcon(lens))"
                         IconColor="@(GetListItemIconColor(lens))">
                    <MudText Typo="Typo.subtitle1">@lens.Name</MudText>
                    <MudText Class="m-1" Typo="Typo.body1">Традиционный сферический дизайн, самый бюджетный вариант немецких линз, рекомендованный диапазон: от + 3,0 до -3,0 D </MudText>
                    <MudStack Row AlignItems="AlignItems.Center">
                        <MudText Typo="Typo.subtitle2" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Стоимость:</MudText>
                        <MudChip Size="Size.Medium" Variant="Variant.Outlined" Color="MudBlazor.Color.Primary">500 руб.</MudChip>
                    </MudStack>
                </MudListItem>
            }
        </MudList>
        <MudStack Row AlignItems="AlignItems.Center">
            <MudSelect Label="Процент тонировки линз" T="double" Variant="Variant.Outlined">
                @foreach (var size in RecipeDataFilter.GetSphRange())
                {
                    <MudSelectItem Value="@(size)" />
                }
            </MudSelect>
        </MudStack>
    </MudCard>
</MudContainer>

@code {
    [Parameter]
    public LensPackage SelectedPackage { get; set; } = null!;
    [Parameter]
    public List<LensPackage> Packages { get; set; } = null!;

    private bool _isLoading;

    private void SelectLens(LensPackage lens)
    {
        SelectedPackage = lens;
    }

    private string GetListItemIcon(LensPackage lens)
    {
        if (SelectedPackage == lens) return Icons.Material.Outlined.Check;

        return Icons.Material.Outlined.DragHandle;
    }

    private MudBlazor.Color GetListItemIconColor(LensPackage lens)
    {
        if (SelectedPackage == lens) return MudBlazor.Color.Success;

        return MudBlazor.Color.Default;
    }
}
