@using MudBlazor.Utilities
@using OpticSalon.Domain.Models
@inject IFrameService FrameService
@inject IImageLoadingService ImageLoadingService
@inject IJSRuntime JS

<MudContainer Class="d-flex align-center justify-center mud-width-full" style="height:90vh;">

    @if (Frame is null)
    {
        <MudAlert Class="m-2" Severity="Severity.Normal">Оправа не найдена...</MudAlert>
        return;
    }

    <MudCard Class="p-4 w-100" Style="border-radius: 15px;"
             Outlined="false" Elevation="5">
        <MudCardHeader>
            <MudStack Row AlignItems="AlignItems.Center">
                <MudIcon Icon="@Icons.Custom.Brands.Awesome" Size="Size.Large"
                         Color="MudBlazor.Color.Secondary"></MudIcon>
                <MudText Typo="Typo.h5" Color="MudBlazor.Color.Secondary">
                    Оправа @($"{Frame.Brand?.Name} {Frame.Model}")
                </MudText>
            </MudStack>
        </MudCardHeader>
        <MudCardContent>
            <MudGrid Justify="Justify.SpaceAround" Spacing="1">
                <MudItem xs="12" sm="4">
                    <div style="display:flex; justify-content:start;">
                        <MudImage id="frame-image" Src="@GetImageSrc(Frame.MainImageName)" Elevation="2" Style="min-width:150px; width: 85%;" Alt="" />
                    </div>
                </MudItem>
                <MudItem xs="12" sm="8">
                    <MudGrid Spacing="1">
                        <MudItem xs="12">
                           <MudStack Row AlignItems="AlignItems.Center">
                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Бренд:</MudText>
                                <MudText Typo="Typo.h6" Style="font-weight: 400">@(Frame.Brand?.Name)</MudText>
                            </MudStack>
                        </MudItem>
                        <MudItem xs="12">
                            <MudStack Row AlignItems="AlignItems.Center">
                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Модель:</MudText>
                                <MudText Typo="Typo.h6" Style="font-weight: 400">@(Frame.Model)</MudText>
                            </MudStack>
                        </MudItem>
                        <MudItem xs="12">
                            <MudStack Row AlignItems="AlignItems.Center">
                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Размеры:</MudText>
                                <MudText Typo="Typo.h6" Style="font-weight: 400">@GetSizeString(Frame.Sizes)</MudText>
                            </MudStack>
                        </MudItem>
                        <MudItem xs="12">
                            <MudStack Row AlignItems="AlignItems.Center">
                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Стоимость:</MudText>
                                <MudChip Size="Size.Large" Variant="Variant.Outlined" Color="MudBlazor.Color.Primary">@(Frame.Cost) руб.</MudChip>
                            </MudStack>
                        </MudItem>
                        <MudItem xs="12">
                            <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Выбранный цвет:</MudText>
                            <MudFab Size="Size.Medium" Class="m-2 ms-0" style="@($"background-color: {Color.Value};")"></MudFab>
                        </MudItem>
                    </MudGrid>
                </MudItem>
            </MudGrid>
        </MudCardContent>
    </MudCard>
</MudContainer>
@code {
    [Parameter]
    public Frame Frame { get; set; } = null!;
    [Parameter]
    public OpticSalon.Domain.Models.Color Color { get; set; } = new();

    private bool _isLoading;
    private bool _isImageLoaded;

    private string GetSizeString(FrameSizes sizes)
    {
        return $"{sizes.LensWidth}-{sizes.DistanceBetweenLens}-{sizes.TempleLenght}";
    }

    private string GetImageSrc(string name)
    {
        return $"https://localhost:7087/getImage?name={name}";
    }
}
