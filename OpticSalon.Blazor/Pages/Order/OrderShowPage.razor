@page "/orderShow"
@using OpticSalon.Blazor.Shared.OrderComponents
@using OpticSalon.Domain.Enums
@using OpticSalon.Domain.Extensions
@using OpticSalon.Domain.Models
@inject IFrameService FrameService
@inject IImageLoadingService ImageLoadingService

<PageTitle>Заказ №342</PageTitle>

@if (_isLoading)
{
    <MudProgressLinear Color="MudBlazor.Color.Info" Indeterminate="true" Class="m-1" />
    return;
}

<MudContainer Class="d-flex align-center justify-center mud-width-full" style="min-height:90vh;">
    <MudCard Class="p-2 m-2" Style="border-radius: 20px;" Outlined="false" Elevation="4">
         <MudCardHeader>
            <MudStack Row AlignItems="AlignItems.Center">
                <MudIcon Class="m-1" Icon="@Icons.Material.Filled.Assignment" Size="Size.Medium" Color="MudBlazor.Color.Secondary"></MudIcon>
                <MudText Typo="Typo.h6" Color="MudBlazor.Color.Secondary"><b>Заказ</b></MudText>
                <MudText Typo="Typo.h6" Color="MudBlazor.Color.Primary"><b>5643</b></MudText>
                <MudText Typo="Typo.h6" Color="MudBlazor.Color.Secondary"><b>от</b></MudText>
                <MudText Typo="Typo.h6" Color="MudBlazor.Color.Primary"><b>21.03.2024</b></MudText>
            </MudStack>
            <MudSpacer/>
            <MudStack Row AlignItems="AlignItems.Center">
                @if (_status != OrderStatus.Issued)
                {
                    <MudChip Color="MudBlazor.Color.Primary">
                        <MudText Typo="Typo.subtitle1">Статус</MudText>
                    </MudChip>
                    <MudSelect T="OrderStatus" Variant="Variant.Outlined"
                        ToStringFunc="@((x) => x.GetDisplayName())">
                        <MudSelectItem Value="@(OrderStatus.Created)" />
                        <MudSelectItem Value="@(OrderStatus.InWork)" />
                        <MudSelectItem Value="@(OrderStatus.Completed)" />
                    </MudSelect>
                }
                else
                {
                    <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Primary">Статус заказа:</MudText>
                    <MudText Typo="Typo.h6" Style="font-weight: 400">@(OrderStatus.Issued.GetDisplayName())</MudText>
                }
                <MudIconButton Icon="@Icons.Material.Filled.Save" Style="min-width: 50px;" Color="MudBlazor.Color.Secondary"></MudIconButton>
            </MudStack>            
        </MudCardHeader>
        <MudCardContent>
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudGrid>
                        <MudItem xs="12">
                            <MudChip Color="MudBlazor.Color.Primary">
                                <MudText Typo="Typo.subtitle1">Оправа</MudText>
                            </MudChip>
                        </MudItem>
                        <MudItem xs="12">
                            <MudGrid Justify="Justify.SpaceAround" Spacing="1">
                                <MudItem xs="12" md="6" sm="6">
                                    <div style="display:flex; justify-content:start;">
                                        <MudImage id="frame-image" Src="@GetImageSrc(_frame.MainImageName)" Elevation="2" Style="min-width:150px; width: 90%;" Alt="" />
                                    </div>
                                </MudItem>
                                <MudItem xs="12" md="6" sm="6">
                                    <MudGrid Spacing="1">
                                        <MudItem xs="12">
                                           <MudStack Row AlignItems="AlignItems.Center">
                                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Бренд:</MudText>
                                                <MudText Typo="Typo.h6" Style="font-weight: 400">@(_frame.Brand?.Name)</MudText>
                                            </MudStack>
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudStack Row AlignItems="AlignItems.Center">
                                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Модель:</MudText>
                                                <MudText Typo="Typo.h6" Style="font-weight: 400">@(_frame.Model)</MudText>
                                            </MudStack>
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudStack Row AlignItems="AlignItems.Center">
                                                <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Размеры:</MudText>
                                                <MudText Typo="Typo.h6" Style="font-weight: 400">@GetSizeString(_frame.Sizes)</MudText>
                                            </MudStack>
                                        </MudItem>
                                        
                                        <MudItem xs="12">
                                            <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Выбранный цвет:</MudText>
                                            <MudFab Size="Size.Medium" Class="m-2 ms-0" style="@($"background-color: {_color?.Value};")"></MudFab>
                                        </MudItem>
                                    </MudGrid>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                    </MudGrid>
                </MudItem>
                <MudItem xs="12" md="6">
                   <MudGrid>
                        <MudItem xs="12">
                            <MudChip Color="MudBlazor.Color.Primary">
                                <MudText Typo="Typo.subtitle1">Рецепт</MudText>
                            </MudChip>
                        </MudItem>
                        <MudItem xs="12">
                            <MudGrid>
                                <MudItem xs="12" sm="1" md="1">
                                    <MudText Typo="Typo.h6" Style="font-weight: 600; text-decoration:underline;" 
                                    Color="MudBlazor.Color.Secondary">OD:</MudText>
                                </MudItem>
                                <MudItem xs="12" sm="4" md="4">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Sph:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12" sm="4" md="4">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Cyl:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12" sm="3" md="3">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Ax:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12" sm="1" md="1">
                                    <MudText Typo="Typo.h6" Style="font-weight: 600; text-decoration:underline;" 
                                    Color="MudBlazor.Color.Secondary">OS:</MudText>
                                </MudItem>
                                <MudItem xs="12" sm="4" md="4">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Sph:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12" sm="4" md="4">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Cyl:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12" sm="3" md="3">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 400" Color="MudBlazor.Color.Secondary">Ax:</MudText>
                                        <MudText Typo="Typo.h6">4.0</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 600;" Color="MudBlazor.Color.Secondary">Dp (mm):</MudText>
                                        <MudText Typo="Typo.h6">54</MudText>
                                    </MudStack>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                   </MudGrid>
                </MudItem>
                <MudItem xs="12">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudGrid Spacing="1">
                                <MudItem xs="12">
                                    <MudChip Color="MudBlazor.Color.Primary">
                                        <MudText Typo="Typo.subtitle1">Прочие данные</MudText>
                                    </MudChip>
                                </MudItem>
                                <MudItem xs="12">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Пакет линз:</MudText>
                                        <MudText Typo="Typo.h6" Style="font-weight: 400">Золотой</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12">
                                    <MudStack Row AlignItems="AlignItems.Center">
                                        <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Номер телефона клиента:</MudText>
                                        <MudText Typo="Typo.h6" Style="font-weight: 400">+7(999)555-12-34</MudText>
                                    </MudStack>
                                </MudItem>
                                <MudItem xs="12">
                                    <MudStack Row AlignItems="AlignItems.Start">
                                        <MudText Typo="Typo.h6" Style="font-weight: 600" Color="MudBlazor.Color.Secondary">Комментарий:</MudText>
                                        <MudText Typo="Typo.h6" Style="font-weight: 400">текст </MudText>
                                    </MudStack>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                    </MudGrid>
                </MudItem>
            </MudGrid>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private Frame _frame = new ();
    private OpticSalon.Domain.Models.Color _color { get; set; } = new();
    private bool _isLoading;
    private OrderStatus _status = OrderStatus.Created;

    protected async override Task OnInitializedAsync()
    {
        await LoadFrame();
    }

    private async Task LoadFrame()
    {
        _isLoading = true;
        var res = await FrameService.GetFrameById(1); 
        _isLoading = false;

        if (res.Success)
        {
            _frame = res.Data!;
        }
    }

    private string GetSizeString(FrameSizes sizes)
    {
        return $"{sizes.LensWidth}-{sizes.DistanceBetweenLens}-{sizes.TempleLenght}";
    }

    private string GetImageSrc(string name)
    {
        return $"https://localhost:7087/getImage?name={name}";
    }
}
